<div class="full">
  <div class="container" >
    <div class="row">
      <div class="col-md-10">
        <div class="panel panel-default">
          <div class="panel-body">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th style="width:20%">Name</th>
                  <th>Description</th>
                  <th>Current service plan</th>
                  <th>Service plans</th>
                  <th>Application plans</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for service in provider.services %}
                  <tr class="service">
                    {% if service.subscribable? %}
                      {% assign subscription = service.subscription %}
                      <td>
                        {{ service.name }}
                      </td>
                      <td>
                        <p>
                          {{ service.description }}
                        </p>
                      </td>

                      <td>
                        {% if subscription %}
                          {{ subscription.plan.name  }}
                          {% unless subscription.live? %}
                            ({{ subscription.state }})
                          {% endunless %}
                        {% endif %}
                        {% unless subscription %}
                          <a class="btn btn-info" href="{{ urls.signup }}?{{ service | to_param }}">Sign up</a>
                        {% endunless %}
                      </td>

                      <td>
                        <dl>
                          {% for service_plan in service.service_plans %}
                            <dt>{{ service_plan.name }}</dt>
                            <dd>
                              {% if service_plan.free? %}
                                 Free
                              {% else %}
                                 <div>
                                   <div>Setup fee {{ service_plan.setup_fee }}</div>
                                   <div>Flat cost {{ service_plan.flat_cost }}</div>
                                </div>
                              {% endif %}
                            </dd>
                          {% endfor %}
                        </dl>
                      </td>

                      <td>
                        <dl>
                        {% for application_plan in service.application_plans %}
                          <dt>{{ application_plan.name }}</dt>
                          <dd>{{ application_plan.system_name }}</dd>
                        {% endfor %}
                        </dl>
                      </td>

                      <td>
                        {% if subscription %}
                            {% if subscription.can.change_plan? %}
                               <a href="#" id="choose-plan-{{subscription.id}}" class="btn btn-default">Review/Change</a>

                               {{ "plans_widget.js" | javascript_include_tag }}
                               {{ "plans_widget.css" | stylesheet_link_tag }}

                                <script type="text/javascript">
                                  //<![CDATA[
                                  $(document).ready(function() {
                                    $("#choose-plan-{{ subscription.id }}").click(function(){
                                      var planID = '{{ subscription.plan.id }}';
                                      var contractID = '{{ subscription.id }}';
                                      var url = '{{ subscription.change_plan_url }}';

                                      function plan_chosen_callback(name, planID){
                                      }

                                      PlanWidget.loadPreview(planID, plan_chosen_callback, url, contractID );

                                      return false;
                                    });
                                  });
                                  //]]>
                                </script>

                            {% endif %}
                       {% else %}
                         {{ "Subscribe" | link_to: service.subscribe_url }}
                       {% endif %}
                      </td>
                      {% endif %}
                  </tr>
                 {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

