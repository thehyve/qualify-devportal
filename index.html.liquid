<header class="jumbotron page-header">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>QuaLiFY Developer Portal</h1>
      </div>
    </div>
  </div>
</header>

{% if current_user %}
  <section class="start">
  <div class="container">
  <div class="row">


    <div class="col-md-6">
      <h1>Services</h1>

      <table class="table">
        <thead>
          <tr>
            <th style="width:20%">Name</th>
            <th>Description</th>
            <th>Plan</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for service in provider.services %}
            <tr class="service">
              {% if service.subscribable? %}
                {% assign subscription = service.subscription %}
                <td>
                  {{ service.name }}
                </td>
                <td>
                  <p>
                    {{ service.description }}
                  </p>
                </td>

                <td>
                  {% if subscription %}
                    {{ subscription.plan.name  }}
                    {% unless subscription.live? %}
                      ({{ subscription.state }})
                    {% endunless %}
                  {% endif %}
        {% unless subscription %}
      <a href="{{ urls.signup }}?{{ service | to_param }}">Signup to {{ service.name }}</a>
      {% endunless %}
                </td>

                <td>
                  {% if subscription %}
                      {% if subscription.can.change_plan? %}
                         <a href="#" id="choose-plan-{{subscription.id}}" class="btn btn-default">Review/Change</a>

                         {{ "plans_widget.js" | javascript_include_tag }}
                         {{ "plans_widget.css" | stylesheet_link_tag }}

                          <script type="text/javascript">
                            //<![CDATA[
                            $(document).ready(function() {
                              $("#choose-plan-{{ subscription.id }}").click(function(){
                                var planID = '{{ subscription.plan.id }}';
                                var contractID = '{{ subscription.id }}';
                                var url = '{{ subscription.change_plan_url }}';

                                function plan_chosen_callback(name, planID){
                                }

                                PlanWidget.loadPreview(planID, plan_chosen_callback, url, contractID );

                                return false;
                              });
                            });
                            //]]>
                          </script>

                      {% endif %}
                 {% else %}
                   {{ "Subscribe to " | append: service.name | link_to: service.subscribe_url }}
                 {% endif %}
                </td>
                {% endif %}
            </tr>
           {% endfor %}
        </tbody>
      </table>
    </div>

    
    <div class="col-md-6">
      <h1>Applications</h1>

      <table class="table panel panel-default" id="applications">
        <thead class="panel-heading">
          <tr>
            <th>Name</th>
            {% if provider.multiple_services_allowed? %}
              <th>Service</th>
            {% endif %}
            <th>Credentials</th>
            <th>State</th>
            <th>
            </th>
          </tr>
        </thead>
        <tbody class="panel-body">
          {% for service in current_account.subscribed_services %}
              {% for application in service.applications %}
                <tr class="{% cycle 'applications': 'odd', 'even' %}" id="application_{{ application.id }}">
                  <td>
                    {{ application.name | link_to: application.url }}
                  </td>
                  {% if provider.multiple_services_allowed? %}
                    <td>{{ service.name }}</td>
                  {% endif %}
                  <td>{{ application.key }}</td>
                  <td>{{ application.state }}</td>
                  <td>
                    {% if application.can.be_updated? %}
                      <a href="{{ application.edit_url }}">
                        <i class="icon-pencil"></i>
                      </a>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
          {% endfor %}
        </tbody>
        <tfoot class="panel-footer">
        <tr>
          <td colspan="3">
          </td>
          <td>
            {% if current_user.can.create_application? %}
              <a href="{{ urls.new_application }}" title="Create new application" class="btn btn-default btn-xs">Create new application</a>
            {% endif %}
          </td>
        </tr>
        </tfoot>
      </table>

    </div>



  </div>
  </section>


{% else %}

  <section class="sell">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h3>Sign in </h3>
          <p>Please sign in to use the developer portal.</p>
        </div>
      </div>
    </div>
  </section>

{% endif %}
